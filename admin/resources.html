<head>
    <link rel="stylesheet" href="assets/css/resources.css">
    <link rel="stylesheet" href="assets/css/root.css">
    <link rel="stylesheet" href="assets/fontawesome-free-6.0.0-beta2-web/css/all.min.css">
</head>
<body>
    <header class="title">
        <div class="container">
            <a href=""><i class="fa-solid fa-arrow-left"></i>Back</a>
            <h1 class="page_title">Resources</h1>
        </div>
    </header>
    <section class="list-table">
        <div class="container">
            <div class="buttons">
                <button type="button" id="add_res">add resource</button>
                <button type="button" id="edit_res">edit resource</button>
                <button type="button" id="remove_res" onclick="removeSelectedRow();">remove resource</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Book No.</th>
                        <th>Title</th>
                        <th>Author Name</th>
                        <th>Date Added</th>
                        <th>Featured</th>
                    </tr>
                </thead>
                <tbody id="table">
                    <tr>
                        <td>1</td>
                        <td>Book Title</td>
                        <td>John Doe1</td>
                        <td>2021-12-11</td>
                        <td><i class="fa-solid fa-star"></i></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Book Title</td>
                        <td>John Doe2</td>
                        <td>2021-12-11</td>
                        <td><i class="fa-solid fa-star"></i></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Book Title</td>
                        <td>John Doe3</td>
                        <td>2021-12-11</td>
                        <td><i class="fa-solid fa-star"></i></td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Book Title</td>
                        <td>John Doe4</td>
                        <td>2021-12-11</td>
                        <td><i class="fa-solid fa-star"></i></td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>Book Title</td>
                        <td>John Doe5</td>
                        <td>2021-12-11</td>
                        <td><i class="fa-solid fa-star"></i></td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>Book Title</td>
                        <td>John Doe6</td>
                        <td>2021-12-11</td>
                        <td><i class="fa-solid fa-star"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
    <div class="edit-resources" id="resources_container">
        <div class="wrapper">
            <button id="close_res">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="editor-wrapper">
                <div class="image-editor">
                    <div class="image-container">
                        <img src="assets/images/3.jpg" alt="">
                    </div>
                    <div class="button-container">
                        <button>Edit Photo</button>
                        <button>Upload a File</button>
                    </div>
                </div>
                <div class="details-editor">
                    <form action="#">
                        <label for="title">Title</label>
                        <input type="text" id="title" placeholder="Title Here...">
                        <label for="author">Author Name</label>
                        <input type="text" id="author" placeholder="Author Here...">
                        <label for="date">Date Added</label>
                        <input type="text" id="date" placeholder="Date Here...">
                        <label for="page">Page No.</label>
                        <input type="text" id="page" placeholder="Page Here...">
                        <label for="isbn">ISBN No.</label>
                        <input type="text" id="isbn" placeholder="ISBN Here...">
                        <label for="description">Description</label>
                        <textarea type="text" id="description" placeholder="Description Here..."></textarea>
                        <label for="keywords">Keywords</label>
                        <input type="text" id="keywords" placeholder="Keywords Here...">
                        <label for="category">Featured</label>
                        <select id="featured" value="nothing">
                            <option value="nothing" selected>--Select an option--</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                        <label for="category">Category</label>
                        <select id="category" onchange="changeSubCategory();">
                            <option value="nothing" selected>--Select a category--</option>
                            <option value="acad">Academics</option>
                            <option value="soc">Sociocultural</option>
                        </select>
                        <label for="subcategory">Subcategory</label>
                        <select id="subcategory">
                            <option value="nothing" selected>--Select a subcategory--</option>
                        </select>
                        <input id="save_changes" type="submit" value="Save Changes" onclick="editSelectedRow();">
                        <input id="add_newRes" type="submit" value="Add Resource" onclick="addNewRow();">
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var rIndex = -1;

    var table = document.getElementById("table");
    var title = document.getElementById("title");
    var author = document.getElementById("author");
    var date = document.getElementById("date");
    var featured = document.getElementById('featured');
    
    var resContainer = document.getElementById("resources_container");
    var addRes = document.getElementById("add_res");
    var editRes = document.getElementById("edit_res");
    var removeRes = document.getElementById("remove_res");
    var closeRes = document.getElementById("close_res");

    var addNewRes = document.getElementById("add_newRes");
    var saveChanges = document.getElementById("save_changes");

    var clicked = false;
    editRes.disabled = true;
    removeRes.disabled = true;
    addRes.disabled = false;

    

    //Showing the edit modal for adding new data
    addRes.addEventListener('click', () => {
        resContainer.classList.add('show');
        saveChanges.classList.add('hide');
        addNewRes.classList.remove('hide');
    })
    //Showing the edit modal for updating/editing data of selected row
    editRes.addEventListener('click', () => {
        resContainer.classList.add('show');
        addNewRes.classList.add('hide');
        saveChanges.classList.remove('hide');
    })
    //Closing the edit modal
    closeRes.addEventListener('click', () => {
        resContainer.classList.remove('show');
    })

    //Outputs the index of selected table row
    function selectedRowToInput() {     
        for(var i = 0; i < table.rows.length; i++) {
            table.rows[i].onclick = function() {
                rIndex = this.rowIndex;
                clicked = !clicked; 
                addRes.disabled = !addRes.disabled;
                editRes.disabled = !editRes.disabled;
                removeRes.disabled = !removeRes.disabled;

                if(clicked) {
                    /*CSS related functions, on click disable 
                    * or show buttons and highlight row
                    */
                    addRes.classList.add('disable');
                    editRes.classList.add('show');
                    removeRes.classList.add('show');
                    this.classList.add('highlight');

                    /*If user clicked on table row and clicked edit, 
                    * changes the value of form inputs on edit 
                    */
                    title.value = this.cells[1].innerHTML;
                    author.value = this.cells[2].innerHTML;
                    date.value = this.cells[3].innerHTML;

                }
                if(!clicked) {
                    /*CSS related functions
                    * Turns back all css to default on unclick
                    */
                    addRes.classList.remove('disable');
                    editRes.classList.remove('show');
                    removeRes.classList.remove('show');
                    title.value = null;
                    author.value = null;
                    date.value = null;

                    /* If user removes unclicked, removes highlight
                    */
                    for(var j = 0; j < table.rows.length; j++){
                        table.rows[j].classList.remove('highlight');
                    }
                    //Sets rowIndex to -1 if no table row is clicked
                    rIndex = -1;
                }

            };
        }
    }

    //runs the function to find clicked rows and returns rIndex
    selectedRowToInput(); 
    
    //Removes the selected row
    function removeSelectedRow() {
        if(rIndex == -1) {
            return;
        }
        //deletes the selected row
        table.deleteRow(rIndex-1);

        //CSS related functions
        addRes.classList.remove('disable');
        editRes.classList.remove('show');
        removeRes.classList.remove('show');

        //After removing a row
        addRes.disabled = !addRes.disabled;
        editRes.disabled = !editRes.disabled;
        removeRes.disabled = !removeRes.disabled;
        clicked = !clicked;
        rIndex = -1;
    }

    function editSelectedRow() {
        //changes the value of rows into the input in edit resource
        table.rows[rIndex-1].cells[1].innerHTML=title.value;
        table.rows[rIndex-1].cells[2].innerHTML=author.value;
        table.rows[rIndex-1].cells[3].innerHTML=date.value;
        
        //if document is featured or not
        if(featured.value=='yes') {
            table.rows[rIndex-1].cells[4].innerHTML='<i class="fa-solid fa-star" style="color:yellow;"></i>';

        } else if(featured.value=='no') {
            table.rows[rIndex-1].cells[4].innerHTML='<i class="fa-solid fa-star" style="color:black;"></i>';

        }
        //removes the modal on save
        resContainer.classList.remove('show');
    }

    function addNewRow() {
        //adds new row and cells.
        var newRow = table.insertRow(table.length),
        cell0 = newRow.insertCell(0), 
        cell1 = newRow.insertCell(1),
        cell2 = newRow.insertCell(2); 
        cell3 = newRow.insertCell(3); 
        cell4 = newRow.insertCell(4); 

        //sets the cell value according to the input
        cell0.innerHTML = table.rows.length;
        cell1.innerHTML = title.value;
        cell2.innerHTML = author.value;
        cell3.innerHTML = date.value;

        //if document is featured or not
        if(featured.value=='yes') {
            cell4.innerHTML='<i class="fa-solid fa-star" style="color:yellow;"></i>';
        } else {
            cell4.innerHTML='<i class="fa-solid fa-star" style="color:black;"></i>';
        }

        //allows the new row to be selectable
        selectedRowToInput();
        resContainer.classList.remove('show');

    }

    var category = document.getElementById("category");
    var subCategory = document.getElementById("subcategory");

    function changeSubCategory() {

        if(category.value=="acad") {
            subCategory.innerHTML = "<option value='bookAc'>Books</option><option value='journalAc'>Journals</option><option value='thesesAc'>Theses</option><option value='articleAc'>Articles</option>"

        } else if (category.value=="soc") {
            subCategory.innerHTML = "<option value='bookSoc'>Books</option><option value='newspaperSoc'>Newspaper Clippings</option><option value='magSoc'>Magazines</option><option value='souvSoc'>Souvenir Programs</option><option value='newsletterSoc'>Newsletter</option>"
            
        } else {
            subCategory.innerHTML = "<option value='null'>--Select a subcategory--</option>"
        }
    }

</script>